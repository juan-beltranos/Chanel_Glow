import{a as v,m as S}from"./Alert.645a9844.js";/* empty css            */import{c as U}from"./sesion.308f604c.js";import{S as g}from"./sweetalert2.all.5497c4f7.js";function x(e){const t={weekday:"long",year:"numeric",month:"long",day:"numeric"},n=new Date(e),o=n.getMonth(),a=n.getDate()+2,c=n.getFullYear();return new Date(Date.UTC(c,o,a)).toLocaleDateString("es-ES",t)}function M(){let e=new Date,t=e.getFullYear(),n=e.getDate(),o=e.getMonth();if(o=o+1,o<10)var a="0"+o;else var a=o.toString;document.querySelector("#fecha").min=t+"-"+a+"-"+n}let s=1,A=1,O=3,T=null;const l={nombre:"",fecha:"",hora:"",servicios:[]},q=document.querySelector(".listado-citas");document.addEventListener("DOMContentLoaded",function(){j()});function j(){X(),L(),k(),E(),N(),B(),R(),Y(),H(),z(),M(),G(),D(),W(),U()}function L(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar"),document.querySelector(`#paso-${s}`).classList.add("mostrar");const n=document.querySelector(".actual");n&&n.classList.remove("actual"),document.querySelector(`[data-paso="${s}"]`).classList.add("actual"),H()}function k(){document.querySelectorAll(".tabs button").forEach(t=>{t.addEventListener("click",function(n){s=parseInt(n.target.dataset.paso),L(),E()})})}function E(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");s===1?(e.classList.add("ocultar-paginador"),t.classList.remove("ocultar-paginador")):s===3?(e.classList.remove("ocultar-paginador"),t.classList.add("ocultar-paginador"),D()):s===4?(e.classList.add("ocultar-paginador"),t.classList.add("ocultar-paginador")):(e.classList.remove("ocultar-paginador"),t.classList.remove("ocultar-paginador")),L()}function N(){document.querySelector("#anterior").addEventListener("click",function(){s<=A||(s--,E())})}function B(){document.querySelector("#siguiente").addEventListener("click",function(){s>=O||(s++,E())})}async function R(){try{const t=await(await fetch(`${v}/servicios`)).json();V(t)}catch(e){console.log(e)}}function V(e){e.forEach(t=>{const{id:n,nombre:o,precio:a}=t,c=document.createElement("P");c.classList.add("nombre-servicio"),c.textContent=o;const r=document.createElement("P");r.classList.add("precio-servicio"),r.textContent=`$${h(a)}`;const i=document.createElement("DIV");i.classList.add("servicio"),i.dataset.idServicio=n,i.onclick=function(){_(t)},i.appendChild(c),i.appendChild(r),document.querySelector("#servicios").appendChild(i)})}function _(e){const{id:t}=e,{servicios:n}=l,o=document.querySelector(`[data-id-servicio="${t}"]`);n.some(a=>a.id===t)?(l.servicios=n.filter(a=>a.id!==t),o.classList.remove("seleccionado")):(l.servicios=[...n,e],o.classList.add("seleccionado"))}function Y(){document.querySelector("#nombre").value=localStorage.getItem("user"),document.querySelector("#nombreCliente").textContent=localStorage.getItem("user"),l.nombre=document.querySelector("#nombre").value}function z(){document.querySelector("#fecha").addEventListener("input",function(t){const n=new Date(t.target.value).getUTCDay();[0].includes(n)?(t.target.value="",S("Los domingos no abrimos.","error",".formulario")):l.fecha=t.target.value})}function G(){document.querySelector("#hora").addEventListener("input",function(t){const o=t.target.value.split(":")[0];o<9||o>18?(t.target.value="",S("hora no valida, cerrado","error",".formulario")):l.hora=t.target.value})}function h(e){return Number(e).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,".")}function D(){l.nombre=document.querySelector("#nombre").value;const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(l).includes("")||l.servicios.length===0)return S("Faltan datos o servicios","error",".contenido-resumen",!1);const{nombre:t,fecha:n,hora:o,servicios:a}=l,c=document.createElement("H2");c.textContent="Resumen de Servicios",e.appendChild(c);let r=0;a.forEach(m=>{const{precio:w,nombre:F}=m;r+=Number(w);const b=document.createElement("DIV");b.classList.add("contenedor-servicios");const $=document.createElement("P");$.textContent=F;const I=document.createElement("P");I.innerHTML=`<span>Precio:</span> ${h(w)}`,b.appendChild($),b.appendChild(I),e.appendChild(b)});const i=document.createElement("P");i.classList.add("total-servicios"),i.innerHTML=`<span>Total a pagar:</span> ${h(r)}`,e.appendChild(i);const C=document.createElement("H2");C.textContent="Resumen de Cita",e.appendChild(C);const y=document.createElement("P");y.innerHTML=`<span>Nombre:</span> ${t}`;const p=document.createElement("P");p.innerHTML=`<span>Fecha:</span> ${x(n)}`;const f=document.createElement("P");f.innerHTML=`<span>Hora:</span> ${o} Horas`;const u=document.createElement("DIV");u.classList.add("txt-center"),u.style.marginBottom="20px";const d=document.createElement("BUTTON");d.classList.add("boton"),d.textContent="Reservar Cita",u.appendChild(d),d.onclick=J,e.appendChild(y),e.appendChild(p),e.appendChild(f),e.appendChild(u)}async function J(){localStorage.getItem("id")||(T=await Q());const{fecha:e,hora:t,servicios:n}=l,o=n.map(c=>c.id),a=new FormData;a.append("fecha",e),a.append("hora",t),a.append("usuarioId",localStorage.getItem("id")?localStorage.getItem("id"):T),a.append("servicios",o.toString());try{const r=await(await fetch(`${v}/citas`,{method:"POST",body:a})).json();r.respuesta.tipo==="exito"&&g.fire("Muy bien!",r.respuesta.mensaje,"success").then(()=>{s=4,L()})}catch{g.fire({icon:"error",title:"Oops...",text:"Hubo un error al guardar la cita"})}}async function H(){try{const t=await(await fetch(`${v}/citasClientes?id_cliente=${localStorage.getItem("id")?localStorage.getItem("id"):T}`)).json();if(t.length===0)return S("No has reservado una cita aun","error",".listado-citas",!1);K(t)}catch(e){console.log(e)}}function K(e){q.innerHTML="";let t=null,n=0,o=null,a=null;if(e.forEach(c=>{const{precio:r,fecha:i,hora:C,servicio:y,id:p}=c;if(t!==p){if(o){const d=document.createElement("P");d.classList.add("total-servicios"),d.innerHTML=`<span>Total a pagar:</span> ${h(n)}`;const m=document.createElement("BUTTON");m.textContent="Cancelar cita",m.classList.add("btn-eliminar"),m.style.height="auto",m.addEventListener("click",function(){P(t)}),a.appendChild(d),a.appendChild(m),o.appendChild(a),q.appendChild(o)}n=0,t=p,o=document.createElement("UL"),o.classList.add("citas");const u=document.createElement("LI");u.innerHTML=`
                <p>ID: <span>${p}</span></p>
                <p>Hora: <span>${C}</span></p>
                <p>Fecha: <span>${x(i)}</span></p>
                <h2>Servicios</h2>
            `,o.appendChild(u),a=document.createElement("DIV"),a.classList.add("opciones")}n+=Number(r);const f=document.createElement("P");f.classList.add("servicioCita"),f.textContent=`${y} : ${h(r)}`,a.appendChild(f)}),o){const c=document.createElement("P");c.classList.add("total-servicios"),c.innerHTML=`<span>Total a pagar:</span> ${h(n)}`;const r=document.createElement("BUTTON");r.textContent="Cancelar cita",r.classList.add("btn-eliminar"),r.style.height="auto",r.addEventListener("click",function(){P(t)}),a.appendChild(c),a.appendChild(r),o.appendChild(a),q.appendChild(o)}}async function P(e){g.fire({title:"Estas seguro/a de cancelar la cita?",showCancelButton:!0,confirmButtonText:"Confirmar"}).then(async t=>{if(t.isConfirmed)try{const o=await(await fetch(`${v}/citas/eliminar?id=${e}`,{method:"POST"})).json();g.fire("Muy bien!",o.mensaje,"success").then(()=>{window.location.reload()})}catch{g.fire({icon:"error",title:"Oops...",text:"Hubo un error al cancelar la cita"})}})}async function Q(){const e=document.querySelector("#nombre").value,t=document.querySelector("#apellido").value,n=document.querySelector("#telefono").value,o=document.querySelector("#email").value;if(e===""||t===""||n===""||o==="")return S("Todos los campos son obligatorios","error",".formulario");const a=new FormData;a.append("nombre",e),a.append("apellido",t),a.append("email",o),a.append("contrase\xF1a",n),a.append("telefono",n),a.append("admin",0),a.append("confirmado",0),a.append("token","");try{const r=await(await fetch(`${v}/usuarios`,{method:"POST",body:a})).json();return r.tipo==="error"?console.log("Error creando el usuario"):(console.log("Usuario creado correctamente"),r.usuario_id.id)}catch(c){console.log(c)}}async function W(){const e=document.querySelector("#nombre"),t=document.querySelector(".barra"),n=document.querySelector("#campoApellido"),o=document.querySelector("#campoTelefono"),a=document.querySelector("#campoCorreo");localStorage.getItem("id")?(n.style.display="none",o.style.display="none",a.style.display="none",e.disabled=!0):t.style.display="none"}function X(){const e=new URL(window.location.href),t=new URLSearchParams(e.search),n=t.get("user"),o=t.get("name");n&&o&&(localStorage.setItem("id",n),localStorage.setItem("user",o),s=4)}
