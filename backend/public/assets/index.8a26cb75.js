import{m as d,a as m}from"./Alert.05c09075.js";import{S as f}from"./sweetalert2.all.5497c4f7.js";function v(e){return e.includes(".")?e:e.replace(/\B(?=(\d{3})+(?!\d))/g,".")}let u=null;const c={nombre:"",fecha:"",hora:"",servicios:[]};(function(e){e(document).ready(function(){function o(){e(window).width()>992?e(".navbar .dropdown").on("mouseover",function(){e(".dropdown-toggle",this).trigger("click")}).on("mouseout",function(){e(".dropdown-toggle",this).trigger("click").blur()}):e(".navbar .dropdown").off("mouseover").off("mouseout")}o(),e(window).resize(o)}),e(window).scroll(function(){e(this).scrollTop()>100?e(".back-to-top").fadeIn("slow"):e(".back-to-top").fadeOut("slow")}),e(".back-to-top").click(function(){return e("html, body").animate({scrollTop:0},1500,"easeInOutExpo"),!1}),e('[data-toggle="counter-up"]').counterUp({delay:10,time:2e3}),e("#date").datetimepicker({format:"L"}),e("#time").datetimepicker({format:"LT"}),e(".service-carousel").owlCarousel({autoplay:!0,smartSpeed:1500,loop:!0,dots:!1,nav:!1,responsive:{0:{items:1},576:{items:2},768:{items:3},992:{items:4},1200:{items:5}}}),e(".pricing-carousel").owlCarousel({autoplay:!0,smartSpeed:1500,margin:30,loop:!0,dots:!1,nav:!1,responsive:{0:{items:1},576:{items:1},768:{items:2}}}),e(".testimonial-carousel").owlCarousel({autoplay:!0,smartSpeed:1500,margin:30,dots:!0,loop:!0,items:1})})(jQuery);document.addEventListener("DOMContentLoaded",function(){h()});function h(){b(),S(),y(),L()}function g(e){e.forEach(o=>{const{id:r,nombre:a,precio:t}=o;console.log(t);const i=document.createElement("P");i.classList.add("nombre-servicio"),i.textContent=a;const s=document.createElement("P");s.classList.add("precio-servicio"),s.textContent=`$${v(t)}`;const n=document.createElement("DIV");n.classList.add("servicio"),n.dataset.idServicio=r,n.onclick=function(){w(o)},n.appendChild(i),n.appendChild(s),document.querySelector("#servicios").appendChild(n)})}function w(e){const{id:o}=e,{servicios:r}=c,a=document.querySelector(`[data-id-servicio="${o}"]`);r.some(t=>t.id===o)?(c.servicios=r.filter(t=>t.id!==o),a.classList.remove("seleccionado")):(c.servicios=[...r,e],a.classList.add("seleccionado"))}function y(){document.querySelector("#fecha").addEventListener("input",function(o){const r=new Date(o.target.value).getUTCDay();[0].includes(r)?(o.target.value="",d("Los domingos no abrimos.","error",".formulario")):c.fecha=o.target.value})}function S(){document.querySelector("#hora").addEventListener("input",function(o){const a=o.target.value.split(":")[0];a<9||a>18?(o.target.value="",d("hora no valida, cerrado","error",".formulario")):c.hora=o.target.value})}async function b(){try{const o=await(await fetch(`${m}/servicios`)).json();g(o)}catch(e){console.log(e)}}async function C(){const e=document.querySelector("#nombre").value,o=document.querySelector("#apellido").value,r=document.querySelector("#telefono").value,a=document.querySelector("#email").value;if(c.nombre=e,e===""||o===""||r===""||a==="")return d("Todos los campos son obligatorios","error",".formulario");const t=new FormData;t.append("nombre",e),t.append("apellido",o),t.append("email",a),t.append("contrase\xF1a",r),t.append("telefono",r),t.append("admin",0),t.append("confirmado",0),t.append("token","");try{const s=await(await fetch(`${m}/usuarios`,{method:"POST",body:t})).json();return s.tipo==="error"?console.log("Error creando el usuario"):(console.log("Usuario creado correctamente"),{id:s.usuario_id.id,name:`${e} ${o}`})}catch(i){console.log(i)}}async function L(){document.querySelector("#reservarCita").addEventListener("click",async e=>{e.preventDefault();const{id:o,name:r}=await C();u=o;const{fecha:a,hora:t,servicios:i}=c,s=i.map(l=>l.id),n=new FormData;n.append("fecha",a),n.append("hora",t),n.append("usuarioId",u),n.append("servicios",s.toString());try{const p=await(await fetch(`${m}/citas`,{method:"POST",body:n})).json();p.respuesta.tipo==="exito"&&f.fire("Muy bien!",p.respuesta.mensaje,"success").then(()=>{window.location.href=`/pages/citas/citas.html?user=${u}&name=${r}`})}catch{f.fire({icon:"error",title:"Oops...",text:"Hubo un error al guardar la cita"})}})}
