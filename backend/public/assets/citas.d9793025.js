import{a as S,m as C}from"./Alert.05c09075.js";/* empty css            */import{c as M}from"./sesion.c4e8e9f9.js";import{S as v}from"./sweetalert2.all.5497c4f7.js";function P(e){const t={weekday:"long",year:"numeric",month:"long",day:"numeric"},o=new Date(e),a=o.getMonth(),n=o.getDate()+2,r=o.getFullYear();return new Date(Date.UTC(r,a,n)).toLocaleDateString("es-ES",t)}function A(){let e=new Date,t=e.getFullYear(),o=e.getDate(),a=e.getMonth();if(a=a+1,a<10)var n="0"+a;else var n=a.toString;document.querySelector("#fecha").min=t+"-"+n+"-"+o}let s=1,O=1,j=3,T=null;const l={nombre:"",fecha:"",hora:"",servicios:[]},q=document.querySelector(".listado-citas");document.addEventListener("DOMContentLoaded",function(){k()});function k(){Z(),b(),B(),E(),R(),N(),V(),z(),I(),G(),A(),J(),x(),X(),M()}function b(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar"),document.querySelector(`#paso-${s}`).classList.add("mostrar");const o=document.querySelector(".actual");o&&o.classList.remove("actual"),document.querySelector(`[data-paso="${s}"]`).classList.add("actual"),I()}function B(){document.querySelectorAll(".tabs button").forEach(t=>{t.addEventListener("click",function(o){s=parseInt(o.target.dataset.paso),b(),E()})})}function E(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");s===1?(e.classList.add("ocultar-paginador"),t.classList.remove("ocultar-paginador")):s===3?(e.classList.remove("ocultar-paginador"),t.classList.add("ocultar-paginador"),x()):s===4?(e.classList.add("ocultar-paginador"),t.classList.add("ocultar-paginador")):(e.classList.remove("ocultar-paginador"),t.classList.remove("ocultar-paginador")),b()}function R(){document.querySelector("#anterior").addEventListener("click",function(){s<=O||(s--,E())})}function N(){document.querySelector("#siguiente").addEventListener("click",function(){s>=j||(s++,E())})}async function V(){try{const t=await(await fetch(`${S}/servicios`)).json();_(t)}catch(e){console.log(e)}}function _(e){e.forEach(t=>{const{id:o,nombre:a,precio:n}=t,r=document.createElement("P");r.classList.add("nombre-servicio"),r.textContent=a;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent=`$${n}`;const i=document.createElement("DIV");i.classList.add("servicio"),i.dataset.idServicio=o,i.onclick=function(){Y(t)},i.appendChild(r),i.appendChild(c),document.querySelector("#servicios").appendChild(i)})}function Y(e){const{id:t}=e,{servicios:o}=l,a=document.querySelector(`[data-id-servicio="${t}"]`);o.some(n=>n.id===t)?(l.servicios=o.filter(n=>n.id!==t),a.classList.remove("seleccionado")):(l.servicios=[...o,e],a.classList.add("seleccionado"))}function z(){document.querySelector("#nombre").value=localStorage.getItem("user"),document.querySelector("#nombreCliente").textContent=localStorage.getItem("user"),l.nombre=document.querySelector("#nombre").value}function G(){document.querySelector("#fecha").addEventListener("input",function(t){const o=new Date(t.target.value).getUTCDay();[0].includes(o)?(t.target.value="",C("Los domingos no abrimos.","error",".formulario")):l.fecha=t.target.value})}function J(){document.querySelector("#hora").addEventListener("input",function(t){const a=t.target.value.split(":")[0];a<9||a>18?(t.target.value="",C("hora no valida, cerrado","error",".formulario")):l.hora=t.target.value})}function x(){l.nombre=document.querySelector("#nombre").value;const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(l).includes("")||l.servicios.length===0)return C("Faltan datos o servicios","error",".contenido-resumen",!1);const{nombre:t,fecha:o,hora:a,servicios:n}=l,r=document.createElement("H2");r.textContent="Resumen de Servicios",e.appendChild(r);let c=0;n.forEach(u=>{const{precio:w,nombre:H}=u,U=w.replace(/\./g,"");c+=parseFloat(U);const L=document.createElement("DIV");L.classList.add("contenedor-servicios");const D=document.createElement("P");D.textContent=H;const F=document.createElement("P");F.innerHTML=`<span>Precio:</span> ${w}`,L.appendChild(D),L.appendChild(F),e.appendChild(L)});const i=c.toLocaleString("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}),h=document.createElement("P");h.classList.add("total-servicios"),h.innerHTML=`<span>Total a pagar:</span> ${i}`,e.appendChild(h);const y=document.createElement("H2");y.textContent="Resumen de Cita",e.appendChild(y);const m=document.createElement("P");m.innerHTML=`<span>Nombre:</span> ${t}`;const p=document.createElement("P");p.innerHTML=`<span>Fecha:</span> ${P(o)}`;const g=document.createElement("P");g.innerHTML=`<span>Hora:</span> ${a} Horas`;const d=document.createElement("DIV");d.classList.add("txt-center"),d.style.marginBottom="20px";const f=document.createElement("BUTTON");f.classList.add("boton"),f.textContent="Reservar Cita",d.appendChild(f),f.onclick=K,e.appendChild(m),e.appendChild(p),e.appendChild(g),e.appendChild(d)}async function K(){localStorage.getItem("id")||(T=await W());const{fecha:e,hora:t,servicios:o}=l,a=o.map(r=>r.id),n=new FormData;n.append("fecha",e),n.append("hora",t),n.append("usuarioId",localStorage.getItem("id")?localStorage.getItem("id"):T),n.append("servicios",a.toString());try{const c=await(await fetch(`${S}/citas`,{method:"POST",body:n})).json();c.respuesta.tipo==="exito"&&v.fire("Muy bien!",c.respuesta.mensaje,"success").then(()=>{s=4,b()})}catch{v.fire({icon:"error",title:"Oops...",text:"Hubo un error al guardar la cita"})}}async function I(){try{const t=await(await fetch(`${S}/citasClientes?id_cliente=${localStorage.getItem("id")?localStorage.getItem("id"):T}`)).json();if(t.length===0)return C("No has reservado una cita aun","error",".listado-citas",!1);Q(t)}catch(e){console.log(e)}}function Q(e){q.innerHTML="";let t=null,o=null,a=null,n=0;if(e.forEach(r=>{const{precio:c,fecha:i,hora:h,servicio:y,id:m}=r;if(t!==m){if(o){const d=document.createElement("P");d.classList.add("total-servicios");const f=n.toLocaleString("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0});d.innerHTML=`<span>Total a pagar:</span> ${f}`;const u=document.createElement("BUTTON");u.textContent="Cancelar cita",u.classList.add("btn-eliminar"),u.style.height="auto",u.addEventListener("click",function(){$(t)}),a.appendChild(d),a.appendChild(u),o.appendChild(a),q.appendChild(o)}n=0,t=m,o=document.createElement("UL"),o.classList.add("citas");const g=document.createElement("LI");g.innerHTML=`
                <p>ID: <span>${m}</span></p>
                <p>Hora: <span>${h}</span></p>
                <p>Fecha: <span>${P(i)}</span></p>
                <h2>Servicios</h2>
            `,o.appendChild(g),a=document.createElement("DIV"),a.classList.add("opciones")}n+=parseFloat(c.replace(/\./g,""));const p=document.createElement("P");p.classList.add("servicioCita"),p.textContent=`${y} : ${c}`,a.appendChild(p)}),o){const r=document.createElement("P");r.classList.add("total-servicios");const c=n.toLocaleString("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0});r.innerHTML=`<span>Total a pagar:</span> ${c}`;const i=document.createElement("BUTTON");i.textContent="Cancelar cita",i.classList.add("btn-eliminar"),i.style.height="auto",i.addEventListener("click",function(){$(t)}),a.appendChild(r),a.appendChild(i),o.appendChild(a),q.appendChild(o)}}async function $(e){v.fire({title:"Estas seguro/a de cancelar la cita?",showCancelButton:!0,confirmButtonText:"Confirmar"}).then(async t=>{if(t.isConfirmed)try{const a=await(await fetch(`${S}/citas/eliminar?id=${e}`,{method:"POST"})).json();v.fire("Muy bien!",a.mensaje,"success").then(()=>{window.location.reload()})}catch{v.fire({icon:"error",title:"Oops...",text:"Hubo un error al cancelar la cita"})}})}async function W(){const e=document.querySelector("#nombre").value,t=document.querySelector("#apellido").value,o=document.querySelector("#telefono").value,a=document.querySelector("#email").value;if(e===""||t===""||o===""||a==="")return C("Todos los campos son obligatorios","error",".formulario");const n=new FormData;n.append("nombre",e),n.append("apellido",t),n.append("email",a),n.append("contrase\xF1a",o),n.append("telefono",o),n.append("admin",0),n.append("confirmado",0),n.append("token","");try{const c=await(await fetch(`${S}/usuarios`,{method:"POST",body:n})).json();return c.tipo==="error"?console.log("Error creando el usuario"):(console.log("Usuario creado correctamente"),c.usuario_id.id)}catch(r){console.log(r)}}async function X(){const e=document.querySelector("#nombre"),t=document.querySelector(".barra"),o=document.querySelector("#campoApellido"),a=document.querySelector("#campoTelefono"),n=document.querySelector("#campoCorreo");localStorage.getItem("id")?(o.style.display="none",a.style.display="none",n.style.display="none",e.disabled=!0):t.style.display="none"}function Z(){const e=new URL(window.location.href),t=new URLSearchParams(e.search),o=t.get("user"),a=t.get("name");o&&a&&(localStorage.setItem("id",o),localStorage.setItem("user",a),s=4)}
